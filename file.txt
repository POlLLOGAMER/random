# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ”§ 1. INSTALACIÃ“N INICIAL  â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

!pip install git+https://github.com/openai/whisper.git -q
!pip install torch torchaudio pydub aeneas ffmpeg-python -q
!apt install ffmpeg espeak -y

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ“ 2. SUBIR UN MP3     â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from google.colab import files
uploaded = files.upload()  # Subir tu .mp3
mp3_file = list(uploaded.keys())[0]

from pydub import AudioSegment
audio = AudioSegment.from_mp3(mp3_file)
audio.export("original.wav", format="wav")

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ§  3. TRANSCRIBIR CON WHISPER â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

import whisper
model = whisper.load_model("base")
result = model.transcribe("original.wav")

print("\nğŸ™ï¸ LETRA ORIGINAL DETECTADA:")
print(result["text"])

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ âœï¸ 4. EDITAR LA LETRA   â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Puedes cambiar esto con lo que quieras que diga la canciÃ³n.
nueva_letra = """Estoy flotando en un charco de memes,
los gatos bailan y me gritan: "sÃ­gueme".
Kaoru va montado en un burrito,
repartiendo flow con ritmo infinito."""

with open("nueva_letra.txt", "w") as f:
    f.write(nueva_letra)

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ§© 5. ALINEAR CON AENEAS   â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from aeneas.executetask import ExecuteTask
from aeneas.task import Task

config_string = u"task_language=eng|is_text_type=plain|os_task_file_format=json"
task = Task(config_string=config_string)
task.audio_file_path_absolute = "original.wav"
task.text_file_path_absolute = "nueva_letra.txt"
task.sync_map_file_path_absolute = "map.json"

print("â±ï¸ Alineando letra con el ritmo original...")
ExecuteTask(task).execute()
task.output_sync_map_file()

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ—£ï¸ 6. GENERAR VOZ CON NUEVA LETRA â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

!pip install git+https://github.com/suno-ai/bark.git -q
from bark import generate_audio

print("ğŸ§ Generando nueva versiÃ³n con Bark TTS...")
new_audio = generate_audio(text=nueva_letra, speaker="v2/en_speaker_9")

with open("modificado.wav", "wb") as f:
    f.write(new_audio)

# â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
# â•‘ ğŸ”Š 7. ESCUCHAR RESULTADO â•‘
# â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

from IPython.display import Audio
print("âœ… Â¡Listo! Escucha tu nueva versiÃ³n:")
Audio("modificado.wav")

